<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Local LLM + TTS Demo</title>
  <link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' fill='%236366f1'/%3E%3C/svg%3E" type="image/svg+xml">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .tab-content { display: none; }
    .tab-content.active { display: block; }
    .spoken { background-color: #fef3c7; }
    .progress-bar {
      transition: width 0.3s ease;
    }
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }
    .loading { animation: pulse 1.5s infinite; }
  </style>
</head>
<body class="font-mono bg-gray-50 min-h-screen">
  <div class="max-w-6xl mx-auto p-4">
    <!-- Header with status -->
    <header class="mb-6">
      <h1 class="text-3xl font-bold text-indigo-600 mb-4">Local LLM + TTS Demo</h1>
      <div class="bg-white p-4 rounded-lg shadow-sm border">
        <div class="flex flex-wrap gap-4 text-sm">
          <span>Device: <strong id="device-status" class="text-indigo-600">detecting...</strong></span>
          <span>LLM: <strong id="llm-status" class="text-green-600">not loaded</strong></span>
          <span>TTS: <strong id="tts-status" class="text-blue-600">not loaded</strong></span>
        </div>
      </div>
    </header>

    <!-- Progress bar for model loading -->
    <div id="loading-progress" class="mb-6 hidden">
      <div class="bg-gray-200 rounded-full h-2">
        <div id="progress-bar" class="progress-bar bg-indigo-600 h-2 rounded-full" style="width: 0%"></div>
      </div>
      <p id="loading-text" class="text-sm text-gray-600 mt-1">Loading models...</p>
    </div>

    <!-- Tab Navigation -->
    <nav class="flex space-x-1 mb-6">
      <button class="tab-btn active bg-indigo-600 text-white px-4 py-2 rounded-lg font-medium" data-tab="llm-stream">LLM Stream</button>
      <button class="tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300" data-tab="tts-only">TTS Only</button>
      <button class="tab-btn bg-gray-200 text-gray-700 px-4 py-2 rounded-lg font-medium hover:bg-gray-300" data-tab="llm-tts">LLM → TTS</button>
    </nav>

    <!-- Tab A: LLM Stream -->
    <div id="llm-stream" class="tab-content active">
      <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-bold mb-4">LLM Text Generation</h2>
        <textarea 
          id="llm-prompt" 
          class="w-full p-3 border rounded-lg resize-none" 
          rows="3" 
          placeholder="Enter your prompt here..."
        >Write a short story about a robot learning to paint.</textarea>
        <div class="flex justify-between items-center mt-4">
          <button id="generate-btn" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg font-medium">
            Generate
          </button>
          <div id="llm-stats" class="text-sm text-gray-600">
            <span id="ttfb">TTFB: -</span> | <span id="tokens-per-sec">Tokens/s: -</span>
          </div>
        </div>
        <div id="llm-output" class="mt-4 p-4 bg-gray-50 rounded-lg min-h-32 whitespace-pre-wrap"></div>
      </div>
    </div>

    <!-- Tab B: TTS Only -->
    <div id="tts-only" class="tab-content">
      <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-bold mb-4">Text-to-Speech</h2>
        <textarea 
          id="tts-text" 
          class="w-full p-3 border rounded-lg resize-none" 
          rows="4"
        >The quick brown fox jumps over the lazy dog. This is a sample text for testing our text-to-speech system. It includes multiple sentences to demonstrate sentence highlighting.</textarea>
        
        <div class="flex flex-wrap gap-4 mt-4">
          <button id="tts-play" class="bg-green-600 hover:bg-green-700 text-white px-4 py-2 rounded-lg">Play</button>
          <button id="tts-pause" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg">Pause</button>
          <button id="tts-resume" class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg">Resume</button>
          <button id="tts-stop" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">Stop</button>
        </div>

        <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label class="block text-sm font-medium mb-1">Rate</label>
            <input type="range" id="tts-rate" min="0.1" max="2" step="0.1" value="1" class="w-full">
            <span id="rate-value" class="text-sm text-gray-600">1.0</span>
          </div>
          <div>
            <label class="block text-sm font-medium mb-1">Pitch</label>
            <input type="range" id="tts-pitch" min="0" max="2" step="0.1" value="1" class="w-full">
            <span id="pitch-value" class="text-sm text-gray-600">1.0</span>
          </div>
          <div id="voice-select-container">
            <label class="block text-sm font-medium mb-1">Voice</label>
            <select id="tts-voice" class="w-full p-2 border rounded">
              <option>Loading voices...</option>
            </select>
          </div>
        </div>

        <div id="tts-output" class="mt-4 p-4 bg-gray-50 rounded-lg min-h-32"></div>
      </div>
    </div>

    <!-- Tab C: LLM → TTS -->
    <div id="llm-tts" class="tab-content">
      <div class="bg-white p-6 rounded-lg shadow">
        <h2 class="text-xl font-bold mb-4">LLM Generation + Speech</h2>
        <textarea 
          id="combined-prompt" 
          class="w-full p-3 border rounded-lg resize-none" 
          rows="3" 
          placeholder="Enter your prompt here..."
        >Tell me a fascinating fact about space exploration.</textarea>
        <div class="flex justify-between items-center mt-4">
          <button id="generate-speak-btn" class="bg-purple-600 hover:bg-purple-700 text-white px-6 py-2 rounded-lg font-medium">
            Generate & Speak
          </button>
          <div class="flex gap-4">
            <button id="combined-pause" class="bg-yellow-600 hover:bg-yellow-700 text-white px-4 py-2 rounded-lg">Pause</button>
            <button id="combined-stop" class="bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-lg">Stop</button>
          </div>
        </div>
        <div id="combined-output" class="mt-4 p-4 bg-gray-50 rounded-lg min-h-32"></div>
      </div>
    </div>

    <!-- Error messages -->
    <div id="error-container" class="fixed bottom-4 right-4 hidden">
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded shadow-lg">
        <span id="error-message"></span>
      </div>
    </div>
  </div>

  <script type="module" src="src/app.js"></script>
</body>
</html>
</html>